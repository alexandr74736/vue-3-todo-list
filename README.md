# Документация проекта "Form Todos"

## Обзор

Проект "Form Todos" - это веб-приложение для управления задачами (todo-список), разработанное с использованием современных технологий фронтенд-разработки. Приложение позволяет пользователям создавать, редактировать и управлять своими задачами с возможностью перетаскивания для изменения порядка.

## Технологии и зависимости

### Основные зависимости:
- Vue 3 - фреймворк для создания пользовательских интерфейсов
- TypeScript - язык программирования, расширяющий JavaScript
- Pinia - библиотека управления состоянием для Vue
- Vue Router 4 - маршрутизация для Vue-приложений
- Element Plus - библиотека UI-компонентов для Vue
- Axios - HTTP-клиент для браузера и Node.js
- vue-draggable-next - компонент для перетаскивания элементов

### Зависимости разработки:
- Vite - инструмент сборки
- Vitest - инструмент тестирования
- Sass - препроцессор CSS
- Prettier - форматтер кода
- @pinia/testing - утилиты для тестирования Pinia
- @types/node - типы для Node.js
- @vitejs/plugin-vue - плагин для использования Vue в Vite
- @vitest/coverage-v8 - инструмент покрытия кода тестами
- @vue/runtime-core - ядро Vue
- @vue/test-utils - утилиты для тестирования Vue
- happy-dom - реализация DOM API для тестирования
- vite-plugin-vue-devtools - плагин для инструментов разработчика Vue

## Архитектурный подход (FSD)

Проект использует архитектурный подход Feature-Sliced Design (FSD), который разделяет приложение на следующие слои:

### 1. Shared (Общие компоненты)
- `ui` - переиспользуемые UI-компоненты
- `api` - функции для работы с API
- `composables` - Vue composables (например, `deepCopy`, `deepEqual`, `isObject`)
- `error-handler` - обработчики ошибок
- `stores` - глобальные хранилища состояния
- `types` - общие типы TypeScript

### 2. Entities (Сущности)
- `user` - логика, связанная с пользователем

### 3. Features (Функциональные возможности)
- `form-todos` - основной функционал приложения для работы с задачами

### 4. Widgets (Виджеты)
- `header` - компонент шапки приложения

### 5. Pages (Страницы)
- `home` - главная страница приложения

### 6. App (Приложение)
- `layouts` - шаблоны страниц
- `router` - маршрутизация
- `styles` - глобальные стили

## Основные компоненты приложения

### TodosForm (src/features/form-todos/ui/TodosForm.vue)
Основной компонент формы задач, реализующий:
- Добавление новых задач
- Удаление задач
- Перетаскивание задач для изменения порядка
- Сохранение задач
- Валидацию формы
- Загрузку и сохранение данных в localStorage

### FormInputCheckbox (src/shared/ui/form/input-checkbox/FormInputCheckbox.vue)
Компонент, объединяющий чекбокс и текстовое поле для задачи:
- Отображает статус выполнения задачи (чекбокс)
- Поле ввода текста задачи
- Обрабатывает изменения состояния

### FormItem (src/shared/ui/form/item/FormItem.vue)
Обертка для элементов формы, обеспечивающая:
- Валидацию полей
- Отображение ошибок
- Стилизацию элементов формы

### MainLayout (src/app/layouts/MainLayout/MainLayout.vue)
Основной макет приложения, включающий:
- Шапку приложения (Header)
- Контентную область
- Обертку для содержимого (MainWrapper)

### App.vue (src/app/App.vue)
Главный компонент приложения, реализующий:
- Динамический выбор макета (MainLayout, AuthLayout, Preloader)
- Инициализацию приложения
- Управление отображением прелоадера
- Обработку ошибок с помощью ErrorBoundary

## Структура данных и типы

### RuleFormItem (src/features/form-todos/types/index.ts)
```typescript
interface RuleFormItem {
  status: boolean;
  text: string;
}
```
Тип для отдельной задачи, содержащий статус выполнения и текст задачи.

### FormBodyDataItem (src/features/form-todos/types/index.ts)
```typescript
interface FormBodyDataItem {
  prop: PropType;
  component: Component;
  itemAttributes: Record<string, unknown>;
  componentsAttributes: Record<string, unknown>;
}
```
Тип для описания элемента формы, включая компонент, атрибуты и настройки.

### FormState (src/features/form-todos/types/index.ts)
```typescript
interface FormState {
  name: string;
 ruleForm: Record<string, RuleFormItem>;
  ruleFormErrors: RuleFormErrors;
  ruleFormRef: InstanceType<typeof ElForm> | undefined;
  rules: FormRules;
  body: FormBody;
  isFormDisabled: boolean;
  isFormSubmitting: boolean;
  formHasError: boolean;
}
```
Состояние формы задач, включающее данные, ошибки, правила валидации и состояние формы.

## API и взаимодействие с localStorage

### Сохранение задач
Функция `saveTodosToLocalStorage` в `src/features/form-todos/api/requests.ts` сохраняет задачи в localStorage:
- Принимает объект задач в формате Record<string, RuleFormItem>
- Валидирует входные данные
- Сохраняет данные в формате JSON
- Возвращает Promise с результатом операции

### Загрузка задач
Функция `getTodosFromLocalStorage` в `src/features/form-todos/api/requests.ts` загружает задачи из localStorage:
- Получает данные из localStorage
- Валидирует и парсит JSON
- Проверяет корректность структуры данных
- Возвращает Promise с задачами или ошибкой

## Модель данных (Pinia Store)

### useTodosForm (src/features/form-todos/model/index.ts)
Хранилище Pinia для управления состоянием формы задач:
- Инициализация данных из localStorage
- Добавление, удаление и изменение задач
- Валидация формы
- Сохранение данных
- Отслеживание изменений формы
- Управление состоянием загрузки

#### Основные функции:
- `getInitData` - загрузка начальных данных из localStorage
- `actionSave` - сохранение задач
- `actionAdd` - добавление новой задачи
- `actionDelete` - удаление задачи
- `validate`, `validateChange`, `validateBlur` - методы валидации
- `setRef` - установка ссылки на форму Element Plus

#### Вычисляемые свойства:
- `loading` - состояние загрузки (инициализация, сохранение, загрузка)
- `bodyDataArray` - массив данных формы с возможностью перетаскивания
- `hasEmptyRequiredFields` - проверка наличия пустых обязательных полей
- `isDeepEqual` - проверка равенства текущего состояния и начального

## Процесс валидации форм

### Валидация при изменении
- Метод `validateChange` валидирует поле при изменении значения
- Использует `validateField` из Element Plus для валидации конкретного поля

### Валидация при потере фокуса
- Метод `validateBlur` валидирует поле при потере фокуса
- Также использует `validateField` для проверки конкретного поля

### Валидация всей формы
- Метод `validate` выполняет валидацию всей формы
- Использует метод `validate` из Element Plus
- Устанавливает флаг ошибки формы в случае неудачи

### Обработка ошибок
- Используется `FormErrorHandler` для обработки ошибок валидации
- Обрабатывает как клиентские, так и серверные ошибки
- Устанавливает соответствующие сообщения об ошибках в полях формы

## Пользовательские сценарии

### Просмотр задач
1. Пользователь заходит на главную страницу
2. Приложение загружает сохраненные задачи из localStorage
3. Задачи отображаются в виде списка с возможностью изменения порядка

### Добавление новой задачи
1. Пользователь нажимает кнопку "Добавить" (плюс)
2. В список добавляется новая пустая задача
3. Пользователь может ввести текст задачи и отметить статус выполнения

### Редактирование задачи
1. Пользователь изменяет текст задачи в поле ввода
2. Система автоматически валидирует поле
3. Пользователь может отметить/снять отметку о выполнении задачи

### Изменение порядка задач
1. Пользователь перетаскивает задачу в нужное место
2. Система обновляет порядок задач в интерфейсе
3. Изменения сохраняются при сохранении формы

### Удаление задачи
1. Пользователь нажимает кнопку удаления (корзина) рядом с задачей
2. Задача удаляется из списка
3. Форма перестраивается без удаленной задачи

### Сохранение задач
1. Пользователь нажимает кнопку "Сохранить"
2. Система валидирует все поля формы
3. При успешной валидации данные сохраняются в localStorage
4. Отображается уведомление об успешном сохранении

## Руководство по запуску и разработке

### Установка зависимостей
```bash
npm install
```

### Запуск в режиме разработки
```bash
npm run dev
```
Приложение будет доступно по адресу http://localhost:5173

### Сборка проекта
```bash
npm run build
```
Собранные файлы будут находиться в папке `dist`

### Запуск тестов
```bash
npm run test:unit
```

### Просмотр сборки
```bash
npm run preview
```

## Структура проекта

```
src/
├── app/                    # Основное приложение
│   ├── App.vue            # Главный компонент приложения
│   ├── index.ts           # Точка входа
│   ├── layouts/           # Макеты страниц
│   │   ├── AuthLayout/    # Макет аутентификации
│   │   └── MainLayout/    # Основной макет
│   ├── router/            # Маршруты приложения
│   └── styles/            # Глобальные стили
├── entities/               # Сущности приложения
│   └── user/              # Сущность пользователя
├── features/               # Функциональные возможности
│   └── form-todos/        # Функционал формы задач
│       ├── api/           # API-запросы
│       ├── constants/     # Константы
│       ├── model/         # Модель данных (Pinia store)
│       ├── types/         # Типы данных
│       └── ui/            # UI-компоненты
├── pages/                  # Страницы приложения
│   └── home/              # Главная страница
├── shared/                 # Общие компоненты и утилиты
│   ├── api/               # API-функции
│   ├── composables/       # Vue composables
│   ├── error-handler/     # Обработчики ошибок
│   ├── stores/            # Хранилища состояния
│   ├── ui/                # UI-компоненты
│   └── types/             # Общие типы
├── types/                  # Глобальные типы
└── widgets/                # Виджеты приложения
    └── header/            # Шапка приложения
```

## Стили и адаптивность

Проект использует SCSS для стилизации с адаптивными значениями:
- Используется миксин `adaptiveValueFunc` для создания адаптивных значений
- Поддержка различных размеров экранов
- Гибкие единицы измерения

## Тестирование

Проект настроен для модульного тестирования с использованием Vitest:
- Тесты для API-запросов
- Тесты для модели данных
- Тесты для компонентов
- Покрытие тестами с использованием v8

## Дополнительные возможности

### Обработка ошибок
- Централизованная обработка ошибок формы
- Отображение уведомлений об успехе/ошибках
- Валидация как на клиенте, так и на "сервере" (имитация)

### Доступность
- Использование aria-атрибутов
- Корректная семантика
- Поддержка клавиатурной навигации

### Производительность
- Использование shallowRef для оптимизации
- Эффективное управление состоянием через Pinia
-_lazy loading_ компонентов через динамические импорты
